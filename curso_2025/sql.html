<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Ci√™ncia de Dados Aplicada √† Epidemiologia - 2025 - 2&nbsp; Banco de Dados &amp; SQL</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./intro.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./sql.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Banco de Dados &amp; SQL</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Ci√™ncia de Dados Aplicada √† Epidemiologia - 2025</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Apresenta√ß√£o do Curso</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introdu√ß√£o √† Ci√™ncia de Dados em Epidemiologia</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sql.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Banco de Dados &amp; SQL</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referencias</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./anexo1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Anexo 1 - Instalando o duckdb</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Conte√∫do</h2>
   
  <ul>
  <li><a href="#introdu√ß√£o" id="toc-introdu√ß√£o" class="nav-link active" data-scroll-target="#introdu√ß√£o"><span class="header-section-number">2.1</span> Introdu√ß√£o</a></li>
  <li><a href="#sistema-gerenciador-de-banco-de-dados" id="toc-sistema-gerenciador-de-banco-de-dados" class="nav-link" data-scroll-target="#sistema-gerenciador-de-banco-de-dados"><span class="header-section-number">2.2</span> Sistema Gerenciador de Banco de Dados</a></li>
  <li><a href="#terminologia-b√°sica" id="toc-terminologia-b√°sica" class="nav-link" data-scroll-target="#terminologia-b√°sica"><span class="header-section-number">2.3</span> Terminologia B√°sica</a></li>
  <li><a href="#modelo-de-dados" id="toc-modelo-de-dados" class="nav-link" data-scroll-target="#modelo-de-dados"><span class="header-section-number">2.4</span> Modelo de Dados</a></li>
  <li><a href="#sql---structured-query-language" id="toc-sql---structured-query-language" class="nav-link" data-scroll-target="#sql---structured-query-language"><span class="header-section-number">3</span> <code>SQL</code> - Structured Query Language</a>
  <ul class="collapse">
  <li><a href="#introdu√ß√£o-ao-sql" id="toc-introdu√ß√£o-ao-sql" class="nav-link" data-scroll-target="#introdu√ß√£o-ao-sql"><span class="header-section-number">3.1</span> Introdu√ß√£o ao <code>SQL</code></a></li>
  <li><a href="#exemplo-de-uma-consulta-dql" id="toc-exemplo-de-uma-consulta-dql" class="nav-link" data-scroll-target="#exemplo-de-uma-consulta-dql"><span class="header-section-number">3.2</span> Exemplo de uma consulta (DQL)</a></li>
  <li><a href="#defini√ß√£o-e-manipula√ß√£o-ddl-dml" id="toc-defini√ß√£o-e-manipula√ß√£o-ddl-dml" class="nav-link" data-scroll-target="#defini√ß√£o-e-manipula√ß√£o-ddl-dml"><span class="header-section-number">3.3</span> Defini√ß√£o e Manipula√ß√£o (DDL &amp; DML)</a>
  <ul class="collapse">
  <li><a href="#criando-uma-tabela" id="toc-criando-uma-tabela" class="nav-link" data-scroll-target="#criando-uma-tabela"><span class="header-section-number">3.3.1</span> Criando uma tabela</a></li>
  <li><a href="#inserindo-dados-populando-a-tabela" id="toc-inserindo-dados-populando-a-tabela" class="nav-link" data-scroll-target="#inserindo-dados-populando-a-tabela"><span class="header-section-number">3.3.2</span> Inserindo dados (populando a tabela)</a></li>
  <li><a href="#apagando-os-dados" id="toc-apagando-os-dados" class="nav-link" data-scroll-target="#apagando-os-dados"><span class="header-section-number">3.3.3</span> Apagando os Dados</a></li>
  <li><a href="#remover-uma-tabela" id="toc-remover-uma-tabela" class="nav-link" data-scroll-target="#remover-uma-tabela"><span class="header-section-number">3.3.4</span> Remover uma Tabela</a></li>
  </ul></li>
  <li><a href="#consulta-dql" id="toc-consulta-dql" class="nav-link" data-scroll-target="#consulta-dql"><span class="header-section-number">3.4</span> Consulta (DQL)</a>
  <ul class="collapse">
  <li><a href="#criando-novas-tabelas-a-partir-de-tabelas-existentes" id="toc-criando-novas-tabelas-a-partir-de-tabelas-existentes" class="nav-link" data-scroll-target="#criando-novas-tabelas-a-partir-de-tabelas-existentes"><span class="header-section-number">3.4.1</span> Criando novas tabelas a partir de tabelas existentes</a></li>
  <li><a href="#joins-relacionando-as-tabelas" id="toc-joins-relacionando-as-tabelas" class="nav-link" data-scroll-target="#joins-relacionando-as-tabelas"><span class="header-section-number">3.4.2</span> Joins (Relacionando as Tabelas)</a></li>
  </ul></li>
  <li><a href="#principais-fun√ß√µes-usadas-em-sql" id="toc-principais-fun√ß√µes-usadas-em-sql" class="nav-link" data-scroll-target="#principais-fun√ß√µes-usadas-em-sql"><span class="header-section-number">3.5</span> Principais fun√ß√µes usadas em <code>SQL</code></a></li>
  <li><a href="#exerc√≠cios-e-pr√°tica" id="toc-exerc√≠cios-e-pr√°tica" class="nav-link" data-scroll-target="#exerc√≠cios-e-pr√°tica"><span class="header-section-number">3.6</span> Exerc√≠cios e pr√°tica</a>
  <ul class="collapse">
  <li><a href="#importando-arquivos-remotos" id="toc-importando-arquivos-remotos" class="nav-link" data-scroll-target="#importando-arquivos-remotos"><span class="header-section-number">3.6.1</span> Importando arquivos remotos</a></li>
  <li><a href="#limpando-a-tabela-do-esus" id="toc-limpando-a-tabela-do-esus" class="nav-link" data-scroll-target="#limpando-a-tabela-do-esus"><span class="header-section-number">3.6.2</span> Limpando a tabela do ESUS</a></li>
  <li><a href="#listando" id="toc-listando" class="nav-link" data-scroll-target="#listando"><span class="header-section-number">3.6.3</span> Listando</a></li>
  </ul></li>
  <li><a href="#exemplos-de-tabula√ß√µes" id="toc-exemplos-de-tabula√ß√µes" class="nav-link" data-scroll-target="#exemplos-de-tabula√ß√µes"><span class="header-section-number">3.7</span> Exemplos de tabula√ß√µes</a>
  <ul class="collapse">
  <li><a href="#tabula√ß√µes-simples" id="toc-tabula√ß√µes-simples" class="nav-link" data-scroll-target="#tabula√ß√µes-simples"><span class="header-section-number">3.7.1</span> Tabula√ß√µes simples</a></li>
  <li><a href="#tabula√ß√µes-avan√ßadas" id="toc-tabula√ß√µes-avan√ßadas" class="nav-link" data-scroll-target="#tabula√ß√µes-avan√ßadas"><span class="header-section-number">3.7.2</span> Tabula√ß√µes avan√ßadas</a></li>
  </ul></li>
  <li><a href="#conclus√£o" id="toc-conclus√£o" class="nav-link" data-scroll-target="#conclus√£o"><span class="header-section-number">3.8</span> Conclus√£o</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Banco de Dados &amp; SQL</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introdu√ß√£o" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="introdu√ß√£o"><span class="header-section-number">2.1</span> Introdu√ß√£o</h2>
<p>Voc√™ j√° parou para pensar na quantidade de dados que geramos no dia-a-dias? Quando postamos uma foto em uma rede social, fazemos uma compra online, assistimos a um v√≠deo, ou usamos um aplicativo de transporte ‚Äî tudo isso envolve um banco de dados por tr√°s.</p>
<p>Bancos de dados s√£o essenciais em praticamente todas as √°reas onde computadores s√£o utilizados: neg√≥cios, engenharia, educa√ß√£o, medicina, e a lista continua. Eles n√£o s√£o apenas um amontoado de informa√ß√µes ‚Äî para ser um banco de dados, √© preciso que esses dados estejam organizados, estruturados e prontos para serem consultados.</p>
<p>Por isso, um arranjo aleat√≥rio de informa√ß√µes n√£o √© um banco de dados. E, embora √∫teis, planilhas n√£o oferecem a mesma estrutura e funcionalidades de um sistema de gerenciamento de banco de dados (SGBD).</p>
</section>
<section id="sistema-gerenciador-de-banco-de-dados" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="sistema-gerenciador-de-banco-de-dados"><span class="header-section-number">2.2</span> Sistema Gerenciador de Banco de Dados</h2>
<p>Um Sistema Gerenciador de Banco de Dados (SGBD) √© uma cole√ß√£o de programas que habilitam usu√°rios a criar e manter um banco de dados.</p>
<p>O SGBD √© um software de prop√≥sito geral, que facilita o processo de defini√ß√£o, constru√ß√£o e manipula√ß√£o de um banco de dados.</p>
<p><img src="./figuras/fig1.png" class="img-fluid"></p>
<p>Exemplos de SGBDs populares:</p>
<ul>
<li>MySQL (muito usado em aplica√ß√µes web)</li>
<li>PostgreSQL (foco em robustez e recursos avan√ßados)</li>
<li>SQLite (leve e ideal para aplica√ß√µes locais ou mobile)</li>
<li>Oracle Database ($$$, amplamente utilizado em grandes corpora√ß√µes)</li>
<li>Duckdb (moderno, usa filosofia OLAP, crescendo rapidamente)</li>
<li>SQL Server (desenvolvido pela Microsoft) ü§Æü§Æü§Æ</li>
</ul>
</section>
<section id="terminologia-b√°sica" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="terminologia-b√°sica"><span class="header-section-number">2.3</span> Terminologia B√°sica</h2>
<p>Antes de trabalhar com SQL, √© importante entender a linguagem b√°sica dos bancos de dados. Esses termos descrevem como as informa√ß√µes s√£o organizadas e manipuladas dentro de um SGBD.</p>
<p><img src="./figuras/fig2.png" class="img-fluid"></p>
<ul>
<li><strong>Campo</strong>: unidade b√°sica de informa√ß√£o m√≠nima com significado (coluna).</li>
<li><strong>Registro</strong>: conjunto de campos (linha).</li>
<li><strong>Atributo</strong>: √°rea que pode conter um tipo de dados. √â a interse√ß√£o de uma linha com uma coluna.</li>
<li><strong>Tabela</strong>: conjunto de registros.</li>
<li><strong>Banco de Dados (BD)</strong>: conjunto de tabelas e as formas de manipula√ß√£o (relacionamentos).</li>
<li><strong>Modelo de Dados</strong>: conjunto de conceitos utilizados para descrever a estrutura de um BD, ou seja, os tipos de dados, relacionamentos e restri√ß√µes sobre estes dados.</li>
<li><strong>Modelo Relacional</strong>: representa os dados em um BD por meio de um conjunto de rela√ß√µes.</li>
<li><strong>Chave Prim√°ria</strong>: coluna que identifica com exclusividade cada linha de um tabela.</li>
<li><strong>Chave Estrangeira</strong>: coluna ou conjunto de colunas referente a uma chave prim√°ria de uma outra tabela. A partir da chave estrangeira podemos relacionar tabelas (join).</li>
</ul>
</section>
<section id="modelo-de-dados" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="modelo-de-dados"><span class="header-section-number">2.4</span> Modelo de Dados</h2>
<p>Um <strong>Modelo de Dados</strong> consiste de um conjunto de conceitos utilizados para descrever a estrutura de um BD, ou seja, os tipos de dados, relacionamentos e restri√ß√µes sobre estes dados.</p>
<p>No Modelo Relacional representa-se os dados em um BD por meio de um conjunto de rela√ß√µes.</p>
<p>Existem diferentes t√©cnicas e tipos de representa√ß√£o de um modelo de dados, como:</p>
<ul>
<li><strong>Modelo Externo</strong> (vis√µes espec√≠ficas para determinados usu√°rios ou aplica√ß√µes)</li>
<li><strong>Modelo Conceitual</strong> (representa√ß√£o abstrata e independente de tecnologia)</li>
<li><strong>Modelo Entidade-Relacionamento (ER)</strong> (foco em entidades, atributos e relacionamentos)</li>
</ul>
<p>Abaixo temos um exemplo de um <strong>diagrama de entidade-relacionamento (ER)</strong> para um sistema de prontu√°rio eletr√¥nico:</p>
<p><img src="./figuras/modelo_ER.png" class="img-fluid"></p>
<p>No diagrama acima, podemos identificar tr√™s elementos principais: entidades, atributos e rela√ß√µes:</p>
<ul>
<li><strong>Entidades:</strong> Representam os objetos principais do sistema (ex: <code>Paciente</code>, <code>M√©dico</code>, <code>Prontu√°rio Eletr√¥nico</code>).</li>
<li><strong>Atributos:</strong> Informa√ß√µes associadas a cada entidade (ex: <code>ID</code>, <code>sexo</code>, <code>dt nasc</code> para <code>Paciente</code>).</li>
<li><strong>Rela√ß√µes:</strong> Indicam como as entidades est√£o conectadas (ex: um <code>Paciente</code> pode ter v√°rios registros nos prontu√°rios eletr√¥nicos ‚Äî rela√ß√£o 1:N; um <code>M√©dico</code> realiza diversas <code>Consultas</code> (1:N)).</li>
</ul>
</section>
<section id="sql---structured-query-language" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> <code>SQL</code> - Structured Query Language</h1>
<section id="introdu√ß√£o-ao-sql" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="introdu√ß√£o-ao-sql"><span class="header-section-number">3.1</span> Introdu√ß√£o ao <code>SQL</code></h2>
<p>O <code>SQL</code> (Structured Query Language) foi criado em 1974 por Donald D. Chamberlin e Raymond F. Boyce, pesquisadores da IBM. Originalmente chamado SEQUEL (Structured English Query Language), ele foi desenvolvido para gerenciar e manipular dados de diferentes bancos de dados relacionais existentes na √©poca.</p>
<p>Desde a d√©cada de 1990 tornou-se a linguagem mais popular para acesso a bancos de dados, associado √† difus√£o dos SGBDs relacionais. Neste mesmo ano, a Oracle lan√ßou seu primeiro SGBD totalmente em <code>SQL</code>.</p>
<p>Em ingl√™s <code>SQL</code> √© pronunciado como S-Q-L ou SEQUEL.</p>
<p>Atualmente <code>SQL</code> √© a linguagem padr√£o para bancos de dados relacionais. Os principais Bancos de Dados Relacionais operam com alguma forma de <code>SQL</code>.</p>
<p>Existem dois tipos b√°sicos de linguagem:</p>
<ul>
<li><p>Linguagem procedural: fornece uma descri√ß√£o detalhada de <strong>COMO</strong> uma tarefa √© realizada, operando sobre um registro ou uma unidade de dados a cada vez. Ex: <code>C</code>, <code>Java</code> etc‚Ä¶</p></li>
<li><p>Linguagem n√£o procedural: √© uma descri√ß√£o de <strong>O QUE</strong> se deseja, onde o sistema dever√° determinar a forma de fazer. Ex: <code>SQL</code>, <code>HTML</code>.</p></li>
</ul>
<p><code>SQL</code> √© uma <strong>linguagem n√£o procedural</strong>, pois permite expressar consultas e opera√ß√µes em bancos de dados (como sele√ß√£o, inser√ß√£o e atualiza√ß√£o de dados) sem especificar como o sistema deve execut√°-las. O usu√°rio declara o que deseja, e o SGBD (Sistema Gerenciador de Banco de Dados) determina como atender a solicita√ß√£o.</p>
<p>Para efeitos did√°ticos, podemos organizar os m√≥dulos do <code>SQL</code> nas seguintes categorias:</p>
<ul>
<li><p><strong>Defini√ß√£o (DDL):</strong> cria√ß√£o do esquema (tabelas e relacionamentos) que atender√° as necessidades no BD;</p></li>
<li><p><strong>Manipula√ß√£o (DML):</strong> inclus√£o, dele√ß√£o e modifica√ß√£o dos dados no BD;</p></li>
<li><p><strong>Consulta (DQL):</strong> realiza√ß√£o de consultas no BD;</p></li>
<li><p><strong>Acessos (DCL):</strong> Controlar permiss√µes e acesso definindo quem pode fazer o que com os tabelas e dados;</p></li>
</ul>
<p>A tabela abaixo resume as principais subcategorias dos comandos em <code>SQL</code>.</p>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Abrevia√ß√£o</th>
<th>Nome completo</th>
<th>Prop√≥sito</th>
<th>Exemplos de comandos</th>
<th><strong>DuckDB</strong>?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>DDL</strong></td>
<td>Data Definition Language</td>
<td>Criar, modificar ou excluir estruturas de dados</td>
<td><code>CREATE</code>, <code>ALTER</code>, <code>DROP</code></td>
<td>‚úÖ <strong>Sim</strong></td>
</tr>
<tr class="even">
<td><strong>DML</strong></td>
<td>Data Manipulation Language</td>
<td>Inserir, atualizar, excluir ou selecionar dados</td>
<td><code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code></td>
<td>‚úÖ <strong>Sim</strong></td>
</tr>
<tr class="odd">
<td><strong>DQL</strong></td>
<td>Data Query Language</td>
<td>Recuperar dados (subcategoria do DML)</td>
<td><code>SELECT</code>, <code>FROM</code>, <code>WHERE</code>, <code>JOIN</code></td>
<td>‚úÖ <strong>Sim</strong></td>
</tr>
<tr class="even">
<td><strong>DCL</strong></td>
<td>Data Control Language</td>
<td>Controlar permiss√µes e acesso aos dados</td>
<td><code>GRANT</code>, <code>REVOKE</code></td>
<td>‚ùå <strong>N√£o</strong></td>
</tr>
</tbody>
</table>
</section>
<section id="exemplo-de-uma-consulta-dql" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="exemplo-de-uma-consulta-dql"><span class="header-section-number">3.2</span> Exemplo de uma consulta (DQL)</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> nome,idade <span class="kw">from</span> pacientes ; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figuras/ex_select.png" class="img-fluid"> ‚Äã</p>
</section>
<section id="defini√ß√£o-e-manipula√ß√£o-ddl-dml" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="defini√ß√£o-e-manipula√ß√£o-ddl-dml"><span class="header-section-number">3.3</span> Defini√ß√£o e Manipula√ß√£o (DDL &amp; DML)</h2>
<p>Para iniciar a defini√ß√£o de um BD √© necess√°rio conhecer os tipos de dados que o BD manipula. Existe uma grande quantidade de diferentes tipos, mas, de uma maneira geral, os tipos mais frequentes s√£o:</p>
<ul>
<li><strong>Num√©ricos</strong>: <code>INT</code>, <code>BIGINT</code>, <code>DECIMAL</code>, <code>FLOAT</code>, <code>DOUBLE</code></li>
<li><strong>Data/Hora</strong>: <code>DATE</code>, <code>TIME</code>, <code>DATETIME</code>, <code>TIMESTAMP</code></li>
<li><strong>Texto</strong>: <code>CHAR</code>, <code>VARCHAR</code>, <code>TEXT</code>, <code>NCHAR</code>, <code>NVARCHAR</code></li>
<li><strong>Booleanos</strong>: <code>BOOLEAN</code>, <code>BIT</code></li>
<li><strong>Bin√°rios</strong>: <code>BINARY</code>, <code>VARBINARY</code>, <code>BLOB</code></li>
<li><strong>Intervalos</strong>: <code>INTERVAL</code> (representa um intervalo de tempo)</li>
</ul>
<p>Obs: O dado faltante √© chamado <code>NULL</code>.</p>
<section id="criando-uma-tabela" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="criando-uma-tabela"><span class="header-section-number">3.3.1</span> Criando uma tabela</h3>
<p>Para criar uma tabela ser√° usada a declara√ß√£o <code>SQL</code> (DDL) <code>create table</code>. De uma maneira geral:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">create</span> <span class="kw">table</span> <span class="op">&lt;</span>nome_tabela<span class="op">&gt;</span> (</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    campo_1 <span class="op">&lt;</span>tipo de dado<span class="op">&gt;</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    campo_2 <span class="op">&lt;</span>tipo de dado<span class="op">&gt;</span>, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    campo_3 <span class="op">&lt;</span>tipo de dados<span class="op">&gt;</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    ) ;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>O ponto e v√≠rgula encerra uma instru√ß√£o deixando-a pronta para ser executada ap√≥s o <enter>.</enter></p>
<p><strong>Exemplo</strong></p>
<p>Como seria a cria√ß√£o de uma tabela que armazenaria os nomes e siglas de todas a UF?</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>‚Äã <span class="kw">CREATE</span> <span class="kw">TABLE</span> estados (</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    uf <span class="dt">integer</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    sigla <span class="dt">char</span>(<span class="dv">2</span>),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    regiao <span class="dt">char</span>(<span class="dv">2</span>),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    nome <span class="dt">varchar</span>(<span class="dv">50</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>) ; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="inserindo-dados-populando-a-tabela" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="inserindo-dados-populando-a-tabela"><span class="header-section-number">3.3.2</span> Inserindo dados (populando a tabela)</h3>
<p>Instru√ß√£o <code>INSERT</code> √© usada para inserir dados na tabela.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> <span class="op">&lt;</span>tabela<span class="op">&gt;</span>[(coluna_1,<span class="op">..</span>.,coluna_n)] <span class="kw">VALUES</span> (valor_1,<span class="op">..</span>.,valor_n);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Exemplo:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> estados(uf, sigla, regiao, nome)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">VALUES</span> (<span class="dv">33</span>, <span class="st">'RJ'</span>, <span class="st">'SE'</span>, <span class="st">'Rio de Janeiro'</span>);</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> estados</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">VALUES</span> (<span class="dv">31</span>, <span class="st">'MG'</span>, <span class="st">'SE'</span>, <span class="st">'Minas Gerais'</span>);</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> estados(sigla, nome, uf, regiao)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="kw">VALUES</span> (<span class="st">'SP'</span>, <span class="st">'S√£o Paulo'</span>, <span class="dv">35</span>, <span class="st">'SE'</span>);</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> estados(nome, regiao, uf, sigla)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="kw">VALUES</span> (<span class="st">'Espirito Santo'</span>, <span class="st">'SE'</span>, <span class="dv">32</span>, <span class="st">'ES'</span>);</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> estados(sigla, regiao, nome)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="kw">VALUES</span>(<span class="st">'GO'</span>, <span class="st">'CO'</span>, <span class="st">'Goias'</span>); <span class="co">-- uf vai receber NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A modifica√ß√£o dos registros √© feita usando o comando <code>UPDATE</code>. Por exemplo:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">UPDATE</span> estado <span class="kw">SET</span> nome <span class="op">=</span> <span class="st">'Goi√°s'</span>, uf <span class="op">=</span> <span class="dv">52</span> <span class="kw">WHERE</span> sigla <span class="op">=</span> <span class="st">'GO'</span>;  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="apagando-os-dados" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="apagando-os-dados"><span class="header-section-number">3.3.3</span> Apagando os Dados</h3>
<p>Instru√ß√£o <code>DELETE</code> √© usada para remover uma ou registros da tabela, possuindo duas formas b√°sicas:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DELETE</span> <span class="kw">FROM</span> <span class="op">&lt;</span>tabela<span class="op">&gt;</span>;\</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- ou </span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">DELETE</span> <span class="kw">FROM</span> <span class="op">&lt;</span>tabela<span class="op">&gt;</span> <span class="kw">WHERE</span> <span class="op">&lt;</span>condi√ß√£o<span class="op">&gt;</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A primeira forma √© obrigat√≥ria e apaga todos os dados da tabela, enquanto que a segunda possui uma parte opcional, a partir do <code>WHERE</code>, que apaga somente os dados da tabela que atendem a uma condi√ß√£o (ou condi√ß√µes) imposta pela cl√°usula <code>WHERE</code>. Exemplo:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DELETE</span> <span class="kw">FROM</span> ESTADOS <span class="kw">WHERE</span> SIGLA <span class="op">=</span> <span class="st">'SP'</span>; <span class="co">-- 1 linha deletada</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">DELETE</span> <span class="kw">FROM</span> ESTADOS <span class="kw">WHERE</span> NOME <span class="op">=</span> <span class="st">'ACRE'</span>;  <span class="co">-- nenhuma linha encontrada</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">DELETE</span> <span class="kw">FROM</span> ESTADOS; <span class="co">-- todas as  linhas deletadas  ATEN√á√ÉO. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="remover-uma-tabela" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="remover-uma-tabela"><span class="header-section-number">3.3.4</span> Remover uma Tabela</h3>
<p>Para se remover uma tabela deve-se usar o comando <code>DROP TABLE</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> <span class="op">&lt;</span>nome_da_tabela<span class="op">&gt;</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Por meio deste comando a tabela deixar√° de existir neste banco de dados, sendo todas as informa√ß√µes contidas nela v√£o ser <strong>TOTALMENTE apagadas</strong> (n√£o tem como desfazer).</p>
<p>Exemplo:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> ESTADOS; <span class="co">-- Tabela eliminada</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="consulta-dql" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="consulta-dql"><span class="header-section-number">3.4</span> Consulta (DQL)</h2>
<p>Instru√ß√£o <code>SELECT</code> √© a ess√™ncia da linguagem SQL. √â por meio dela que se recupera dados de um banco de dados. De modo simples, forma declarativa, est√° se dizendo ao BD quais informa√ß√µes foram selecionadas para serem recuperadas.</p>
<p>Pode-se dividir esta instru√ß√£o em quatro partes b√°sicas:</p>
<ul>
<li><code>SELECT</code> seguido dos atributos que se deseja ver (obrigat√≥rio)</li>
<li><code>FROM</code> seguido de onde se obter√£o os dados (obrigat√≥rio)</li>
<li><code>WHERE</code> seguido das restri√ß√µes de recupera√ß√£o (opcional)</li>
<li><code>ORDER BY</code> seguido da forma como os dados ser√£o classificados (opcional)</li>
<li><code>GROUP BY</code> serve para agregar os dados (opcional)</li>
</ul>
<p>O s√≠mbolo asterisco * significa que todos atributos da rela√ß√£o informada dever√£o ser recuperados.</p>
<p>Exemplo:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">from</span> ESTADO;</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">FROM</span> estado <span class="kw">WHERE</span> SIGLA<span class="op">=</span><span class="st">'GO'</span> <span class="kw">OR</span> NOME<span class="op">=</span><span class="st">'Acre'</span> ; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>SELECT</code> ser√° a instru√ß√£o mais comumente usada na linguagem <code>SQL</code>. Repare que o <code>SQL</code> n√£o √© <em>case sensitive</em> como a maioria das linguagens!</p>
<p>Na cl√°usula <code>WHERE</code> ser√£o utilizados alguns operadores de compara√ß√£o e l√≥gicos para que a condi√ß√£o seja especificada. Os operadores logicos usados em <code>SQL</code> s√£o:</p>
<p><img src="figuras/where.png" class="img-fluid"></p>
<section id="criando-novas-tabelas-a-partir-de-tabelas-existentes" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="criando-novas-tabelas-a-partir-de-tabelas-existentes"><span class="header-section-number">3.4.1</span> Criando novas tabelas a partir de tabelas existentes</h3>
<p>√â muito simples a cria√ß√£o de novas tabelas a partir de outras, basta usar o <code>CREATE TABLE</code> com o resultado de um <code>SELECT</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> sudeste <span class="kw">AS</span> (<span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> estados <span class="kw">WHERE</span> regiao <span class="op">=</span> <span class="st">'SE'</span>)  ;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="joins-relacionando-as-tabelas" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="joins-relacionando-as-tabelas"><span class="header-section-number">3.4.2</span> Joins (Relacionando as Tabelas)</h3>
<p>Existem diversas maneiras de se fazer o relacionamento entre duas tabelas. Os mais comuns s√£o:</p>
<ol type="1">
<li><code>INNER JOIN</code>: Este √© simples e comumente empregado. Esta query retornar√° todos os registros da tabela A (esquerda) que t√™m correspond√™ncia com a tabela B (direita). Ou seja, o que existe de comum entre A e B. Podemos escrever este JOIN da seguinte forma:</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> A <span class="kw">INNER</span> <span class="kw">JOIN</span> B <span class="kw">ON</span> A.chave <span class="op">=</span> B.chave</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li><code>LEFT JOIN</code>: Esta consulta retorna todos os registros da tabela A (esquerda) e o que existir em comum com a tabela B (direita). O c√≥digo fica da seguinte forma:</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> A <span class="kw">LEFT</span> <span class="kw">JOIN</span> B <span class="kw">ON</span> A.chave <span class="op">=</span> B.chave</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="1">
<li><code>OUTER JOIN</code>: Este relacionamento √© conhecido tamb√©m como <code>FULL OUTER JOIN</code> ou <code>FULL JOIN</code>. Esta consulta retornar√° todos os registros das duas tabelas e juntando tamb√©m os registros correspondentes entre as duas tabelas. O que for diferente nas duas tabelas ficara com o valor NULL. O c√≥digo ficar√° da seguinte forma:</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> A <span class="kw">FULL</span> <span class="kw">OUTER</span> <span class="kw">JOIN</span> B <span class="kw">ON</span> A.chave <span class="op">=</span> B.chave</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="figuras/SQL_Joins.png" class="img-fluid"> <a href="https://www.codeproject.com/Articles/33052/Visual-Representation-of-SQL-Joins">Fonte da figura</a></p>
</section>
</section>
<section id="principais-fun√ß√µes-usadas-em-sql" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="principais-fun√ß√µes-usadas-em-sql"><span class="header-section-number">3.5</span> Principais fun√ß√µes usadas em <code>SQL</code></h2>
<p>Seguem algumas fun√ß√µes comumente usadas em <code>SQL</code>, lembre-se que cada vers√£o e SGDB usa dialetos diferentes.</p>
<p>Fun√ß√µes matem√°ticas (mais comumente usadas):</p>
<ul>
<li><code>ABS(n)</code>: Devolve o valor absoluto de <code>n</code>.</li>
<li><code>CEIL(n)</code>: Obt√©m o valor inteiro imediatamente superior ou igual a <code>n</code>.</li>
<li><code>FLOOR(n)</code>: Devolve o valor inteiro imediatamente inferior ou igual a <code>n</code>.</li>
<li><code>MOD(m, n)</code>: Devolve o resto resultante de dividir <code>m</code> entre <code>n</code>.</li>
<li><code>POWER(m, exponente)</code>: Calcula a pot√™ncia de um n√∫mero.</li>
<li><code>ROUND(n√∫mero [, m])</code>: Arredonda n√∫meros com o n√∫mero de d√≠gitos de precis√£o indicados.</li>
<li><code>SIGN(valor)</code>: Indica o sinal do <code>valor</code>.</li>
<li><code>SQRT(n)</code>: Devolve a raiz quadrada de <code>n</code>.</li>
<li><code>TRUNC(n√∫mero, [m])</code>: Trunca n√∫meros para que tenham uma certa quantidade de d√≠gitos de precis√£o.</li>
</ul>
<p>Fun√ß√µes Agregadas :</p>
<ul>
<li><code>COUNT ( * | Express√£o)</code>: Conta o n√∫mero de ocorr√™ncias (A op√ß√£o ‚Äú*‚Äù conta todos os registros selecionados).</li>
<li><code>AVG (n)</code>: Calcula o valor m√©dio de <code>n</code> ignorando os valores nulos.</li>
<li><code>MAX (express√£o)</code>: Calcula o m√°ximo.</li>
<li><code>MIN (express√£o)</code>: Calcula o m√≠nimo.</li>
<li><code>SUM (express√£o)</code>: Obt√©m a soma dos valores da express√£o (se houver <code>NULL</code> retorna <code>NULL</code>).</li>
<li><code>TOTAL (express√£o)</code>: soma ignorando <code>NULL</code>.</li>
</ul>
<p>Fun√ß√µes de caracteres:</p>
<ul>
<li><code>CONCAT (str1, str2)</code>: Devolve ‚Äústr1‚Äù concatenada com ‚Äústr2‚Äù.</li>
<li><code>LOWER (str)</code>: Devolve a string em min√∫sculas.</li>
<li><code>UPPER (str)</code>: Devolve a string em mai√∫sculas.</li>
<li><code>SUBSTR (str, m [,n])</code>: Obt√©m parte de uma string.</li>
<li><code>LENGTH (str)</code>: Devolve o n√∫mero de caracteres de str.</li>
<li><code>REPLACE (str, cadeia_busca [, cadeia_substitui√ß√£o])</code>: Substitui um caractere ou caracteres de uma cadeia com 0 ou mais caracteres.</li>
</ul>
<p>Fun√ß√µes de datas:</p>
<ul>
<li><code>DATE()</code>: Retorna a data ou transforma em data.</li>
<li><code>TIME()</code>: Retorna tempo.</li>
<li><code>STRFTIME(fmt, data)</code>: Formata a data.</li>
</ul>
<p>Exemplos:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">count</span>(<span class="op">*</span>) <span class="kw">from</span> Estados;</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> now() ; </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">round</span>(<span class="fl">355.0</span> <span class="op">/</span> <span class="fl">113.0</span>,<span class="dv">6</span>) ;  <span class="co">-- que n√∫mero √© esse? Teste sem o .0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="meu-raid" style="color:black;background-color:rgb(101, 236, 11);font-size: 100%; padding: 15px; border-radius: 10px;">
<p>Para saber mais sobre os tipos de dados e fun√ß√µes do duckDB consulte o <a href="https://duckdb.org/docs/stable/">Documenta√ß√£o online do duckDB</a>.</p>
</div>
</section>
<section id="exerc√≠cios-e-pr√°tica" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="exerc√≠cios-e-pr√°tica"><span class="header-section-number">3.6</span> Exerc√≠cios e pr√°tica</h2>
<p>Usando o duckDB (<a href="./anexo1.html">instala√ß√£o feita aqui</a>), fa√ßa os exerc√≠cios a seguir.</p>
<p>Crie a tabela <code>pessoas</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Criar tabela pessoas</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> pessoas (</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    cpf BIGINT <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    nome <span class="dt">VARCHAR</span>(<span class="dv">100</span>),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    idade <span class="dt">INT</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    sexo <span class="dt">VARCHAR</span>(<span class="dv">10</span>),</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    telefone <span class="dt">VARCHAR</span>(<span class="dv">20</span>),</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    uf <span class="dt">int</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Insira dados na tabela <code>pessoas</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Inserir dados de pessoas </span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> pessoas (cpf, nome, idade, sexo, telefone,uf)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">VALUES</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>(<span class="dv">12345678901</span>, <span class="st">'Jo√£o Silva'</span>, <span class="dv">35</span>, <span class="st">'Masculino'</span>, <span class="st">'(21) 98765-4321'</span>,<span class="dv">33</span>),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>(<span class="dv">23456789012</span>, <span class="st">'Maria Oliveira'</span>, <span class="dv">28</span>, <span class="st">'Feminino'</span>, <span class="st">'(21) 99565-0987'</span>,<span class="dv">33</span>),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>(<span class="dv">34567890123</span>, <span class="st">'Pedro Almeida'</span>, <span class="dv">42</span>, <span class="st">'Masculino'</span>, <span class="st">'(31) 78765-4323'</span>, <span class="dv">31</span>),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>(<span class="dv">45678901234</span>, <span class="st">'Ana Costa'</span>, <span class="dv">31</span>, <span class="st">'Feminino'</span>, <span class="st">'(11) 98765-4324'</span>,<span class="dv">35</span>),</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>(<span class="dv">56789012345</span>, <span class="st">'Lucas Ferreira'</span>, <span class="dv">25</span>, <span class="st">'Masculino'</span>, <span class="st">'(21) 98765-4325'</span>,<span class="dv">31</span>),</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>(<span class="dv">67890123456</span>, <span class="st">'Julia Santos'</span>, <span class="dv">29</span>, <span class="st">'Feminino'</span>, <span class="st">'(22) 98765-4326'</span>,<span class="dv">32</span>),</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>(<span class="dv">78901234567</span>, <span class="st">'Ricardo Lima'</span>, <span class="dv">50</span>, <span class="st">'Masculino'</span>, <span class="st">'(11) 98765-4327'</span>,<span class="dv">35</span>),</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>(<span class="dv">89012345678</span>, <span class="st">'Fernanda Souza'</span>, <span class="dv">33</span>, <span class="st">'Feminino'</span>, <span class="st">'(65) 98765-4328'</span>, <span class="dv">52</span>),</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>(<span class="dv">90123456789</span>, <span class="st">'Mateus Pereira'</span>, <span class="dv">40</span>, <span class="st">'Masculino'</span>, <span class="st">'(21) 98765-4329'</span>,<span class="dv">33</span>),</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>(<span class="dv">10234567890</span>, <span class="st">'Isabela Lima'</span>, <span class="dv">27</span>, <span class="st">'Feminino'</span>, <span class="st">'(68) 98765-4330'</span>,<span class="dv">11</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Crie a tabela <code>estados</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> estados (</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    uf <span class="dt">INT</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    sigla <span class="dt">VARCHAR</span>(<span class="dv">2</span>),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    nome <span class="dt">VARCHAR</span>(<span class="dv">50</span>),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    regiao <span class="dt">VARCHAR</span>(<span class="dv">20</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    );</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Insira dados na tabela <code>estados</code>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> estados (uf,sigla,nome,regiao)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">VALUES</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>(<span class="dv">12</span>,<span class="st">'AC'</span>,<span class="st">'Acre'</span>,<span class="st">'Norte'</span>),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>(<span class="dv">13</span>,<span class="st">'AM'</span>,<span class="st">'Amazonas'</span>,<span class="st">'Norte'</span>),</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>(<span class="dv">14</span>,<span class="st">'RR'</span>,<span class="st">'Roraima'</span>,<span class="st">'Norte'</span>),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>(<span class="dv">15</span>,<span class="st">'PA'</span>,<span class="st">'Par√°'</span>,<span class="st">'Norte'</span>),</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>(<span class="dv">16</span>,<span class="st">'AP'</span>,<span class="st">'Amap√°'</span>,<span class="st">'Norte'</span>),</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>(<span class="dv">17</span>,<span class="st">'TO'</span>,<span class="st">'Tocantins'</span>,<span class="st">'Norte'</span>),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>(<span class="dv">21</span>,<span class="st">'MA'</span>,<span class="st">'Maranh√£o'</span>,<span class="st">'Nordeste'</span>),</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>(<span class="dv">22</span>,<span class="st">'PI'</span>,<span class="st">'Piau√≠'</span>,<span class="st">'Nordeste'</span>),</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>(<span class="dv">23</span>,<span class="st">'CE'</span>,<span class="st">'Cear√°'</span>,<span class="st">'Nordeste'</span>),</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>(<span class="dv">24</span>,<span class="st">'RN'</span>,<span class="st">'Rio Grande do Norte'</span>,<span class="st">'Nordeste'</span>),</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>(<span class="dv">25</span>,<span class="st">'PB'</span>,<span class="st">'Para√≠ba'</span>,<span class="st">'Nordeste'</span>),</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>(<span class="dv">26</span>,<span class="st">'PE'</span>,<span class="st">'Pernambuco'</span>,<span class="st">'Nordeste'</span>),</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>(<span class="dv">27</span>,<span class="st">'AL'</span>,<span class="st">'Alagoas'</span>,<span class="st">'Nordeste'</span>),</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>(<span class="dv">28</span>,<span class="st">'SE'</span>,<span class="st">'Sergipe'</span>,<span class="st">'Nordeste'</span>),</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>(<span class="dv">29</span>,<span class="st">'BA'</span>,<span class="st">'Bahia'</span>,<span class="st">'Nordeste'</span>),</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>(<span class="dv">31</span>,<span class="st">'MG'</span>,<span class="st">'Minas Gerais'</span>,<span class="st">'Sudeste'</span>),</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>(<span class="dv">32</span>,<span class="st">'ES'</span>,<span class="st">'Esp√≠rito Santo'</span>,<span class="st">'Sudeste'</span>),</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>(<span class="dv">33</span>,<span class="st">'RJ'</span>,<span class="st">'Rio de Janeiro'</span>,<span class="st">'Sudeste'</span>),</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>(<span class="dv">35</span>,<span class="st">'SP'</span>,<span class="st">'S√£o Paulo'</span>,<span class="st">'Sudeste'</span>),</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>(<span class="dv">41</span>,<span class="st">'PR'</span>,<span class="st">'Paran√°'</span>,<span class="st">'Sul'</span>),</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>(<span class="dv">42</span>,<span class="st">'SC'</span>,<span class="st">'Santa Catarina'</span>,<span class="st">'Sul'</span>),</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>(<span class="dv">43</span>,<span class="st">'RS'</span>,<span class="st">'Rio Grande do Sul'</span>,<span class="st">'Sul'</span>),</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>(<span class="dv">50</span>,<span class="st">'MS'</span>,<span class="st">'Mato Grosso do Sul'</span>,<span class="st">'Centro-Oeste'</span>),</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>(<span class="dv">51</span>,<span class="st">'MT'</span>,<span class="st">'Mato Grosso'</span>,<span class="st">'Centro-Oeste'</span>),</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>(<span class="dv">52</span>,<span class="st">'GO'</span>,<span class="st">'Goi√°s'</span>,<span class="st">'Centro-Oeste'</span>),</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>(<span class="dv">53</span>,<span class="st">'DF'</span>,<span class="st">'Distrito Federal'</span>,<span class="st">'Centro-Oeste'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Siga os passos abaixo:</p>
<ol type="1">
<li><p>Certifique-se que as tabelas foram criadas listando o conte√∫do de cada uma delas (dica: use <code>SELECT</code>).</p></li>
<li><p>Insira mais um registro a tabela <code>pessoas</code> usando o comando abaixo:</p></li>
</ol>
<div class="sourceCode" id="cb21"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">insert</span> <span class="kw">into</span> pessoas <span class="kw">values</span> (<span class="dv">53565635794</span>, <span class="st">'Joana da Silva'</span>, <span class="dv">33</span>, <span class="st">'Feminino'</span>, <span class="st">''</span>, <span class="kw">NULL</span>) ;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>O registro foi inserido?</li>
<li><code>NULL</code> √© igual a ‚Äô‚Äô ?</li>
<li>Qual √© a idade m√©dia das pessoas?</li>
</ul>
<ol start="3" type="1">
<li>Em seguida, vamos adicionar mais um registro:</li>
</ol>
<div class="sourceCode" id="cb22"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">insert</span> <span class="kw">into</span> pessoas <span class="kw">values</span> (<span class="dv">78901234567</span>, <span class="st">'Carlos Valente'</span>,<span class="dv">53</span>,<span class="st">'Masculino'</span>,<span class="st">'(21)9765-4320'</span>,<span class="dv">26</span>) ;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>O registro foi inserido?</li>
<li>Em caso negativo, alguma ideia do motivo ?</li>
<li>Que campo voc√™ deve modificar para poder incluir esse registro?</li>
</ul>
<ol start="4" type="1">
<li>Voc√™ quer saber qual a frequ√™ncia por <code>sexo</code> na tabela <code>pessoas</code> e usou o c√≥digo abaixo:</li>
</ol>
<div class="sourceCode" id="cb23"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> sexo, <span class="fu">count</span>(sexo) <span class="kw">from</span> pessoas </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Funcionou? (lembre-se do terminador)</li>
<li>Funcionou quando adicionou o ‚Äò;‚Äô ? (dica: leia as mensagens de erro com aten√ß√£o)</li>
</ul>
<ol start="5" type="1">
<li>Fa√ßa um join entre as tabelas <code>pessoas</code> e <code>estados</code>.</li>
</ol>
<div class="sourceCode" id="cb24"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> pessoas </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">left</span> <span class="kw">join</span> estados <span class="kw">on</span> pessoas.uf <span class="op">=</span> estados.uf ;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Por que a Isabela Lima e a Joana da Silva ficaram sem UF?</li>
</ul>
<ol start="6" type="1">
<li>Fa√ßa agora um <code>INNER JOIN</code> e responda o que muda em rela√ß√£o ao <code>left join</code>.</li>
</ol>
<div class="sourceCode" id="cb25"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> pessoas </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">inner</span> <span class="kw">join</span> estados <span class="kw">on</span> pessoas.uf <span class="op">=</span> estados.uf ;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="7" type="1">
<li>Vamos corrigir os problemas nas nossas tabelas:
<ol type="a">
<li>Insira na tabela estados uma linha para Rond√¥nia (RO) que tem o c√≥digo 11 e est√° na regi√£o norte.</li>
<li>Modifique o registo de Joana da Silva para a UF 29 (lembre-se de usar <code>where</code> para especificar o que vai ser alterado).</li>
</ol></li>
</ol>
<p>Selecione com o mouse para ver a resposta no box abaixo!</p>
<div class="meu-resp" style="color:yellow;background-color:yellow;font-size: 100%; padding: 15px; border-radius: 10px;">
<ol type="a">
<li><p>INSERT INTO estados VALUES (11,‚ÄòRO‚Äô,‚ÄòRond√¥nia‚Äô,‚ÄòNorte‚Äô) ;</p></li>
<li><p>UPDATE pessoas set uf = 29 where cpf = ‚Äò53565635794‚Äô;</p></li>
</ol>
</div>
<p>Agora que nosso dado est√° devidamente corrigido, vamos criar uma nova tabela chama <code>pessoa_uf</code> que recebe os dados unidos de ambas as tabelas.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">create</span> <span class="kw">or</span> <span class="kw">replace</span> <span class="kw">table</span> pessoa_uf <span class="kw">as</span> (</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> pessoas <span class="kw">as</span> p </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="kw">left</span> <span class="kw">join</span> estados <span class="kw">as</span> e <span class="kw">on</span> p.uf <span class="op">=</span> e.uf );</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Aqui poder√≠amos usar o INNER JOIN pois ficariam iguais!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Aqui um exemplo de como qualquer tabela pode ser facilmente exportada para csv (neste caso csv2, com delimitador <strong>‚Äú;‚Äù</strong> , o default √© <strong>,</strong> .</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> pessoa_uf <span class="kw">TO</span> <span class="st">'pessoas.csv'</span> (<span class="kw">HEADER</span>, DELIMITER <span class="st">';'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="importando-arquivos-remotos" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="importando-arquivos-remotos"><span class="header-section-number">3.6.1</span> Importando arquivos remotos</h3>
<section id="importando-csv-com-a-popula√ß√£o-do-tcu-de-2024" class="level4" data-number="3.6.1.1">
<h4 data-number="3.6.1.1" class="anchored" data-anchor-id="importando-csv-com-a-popula√ß√£o-do-tcu-de-2024"><span class="header-section-number">3.6.1.1</span> Importando CSV com a popula√ß√£o do TCU de 2024</h4>
<div class="sourceCode" id="cb28"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- lendo a popula√ß√£o do TCU por muni do github</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="kw">create</span> <span class="kw">table</span> tcu <span class="kw">as</span> (</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="st">'https://raw.githubusercontent.com/ogcruz/curso_DS2025/refs/heads/main/sql/poptcu_2024.csv'</span>) ; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- cria a a coluna num√©rica UF </span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">create</span> <span class="kw">or</span> <span class="kw">replace</span> <span class="kw">table</span> tcu <span class="kw">as</span> (</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">select</span> <span class="fu">substr</span>(MUNI_RES:<span class="ch">:CHAR</span>,<span class="dv">1</span>,<span class="dv">2</span>) <span class="kw">as</span> uf,<span class="op">*</span>, <span class="kw">from</span> tcu) ;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- soma a popula√ß√£o por UF</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="kw">create</span> <span class="kw">table</span> pop_tcu <span class="kw">as</span> (</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">select</span> uf,<span class="fu">sum</span>(POPULACAO) <span class="kw">as</span> pop2024 <span class="kw">from</span> tcu <span class="kw">group</span> <span class="kw">by</span> uf <span class="kw">order</span> <span class="kw">by</span> pop2024 <span class="kw">desc</span> ) ;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- atualiza a tabela estados com a pop do TCU de 2024</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">create</span> <span class="kw">table</span> estados <span class="kw">as</span> (</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="op">*</span>  <span class="kw">from</span> estados e </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="kw">left</span> <span class="kw">join</span> pop_tcu p <span class="kw">on</span> e.uf <span class="op">=</span> p.uf </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="kw">order</span> <span class="kw">by</span> e.uf ) ;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="importando-um-parquet-com-esus-do-rj-de-2020" class="level4" data-number="3.6.1.2">
<h4 data-number="3.6.1.2" class="anchored" data-anchor-id="importando-um-parquet-com-esus-do-rj-de-2020"><span class="header-section-number">3.6.1.2</span> Importando um parquet com ESUS do RJ de 2020</h4>
<p>Vamos importar um arquivo paquet com cerca de ~2.56 milh√µes de registos direto da nuvem da Fiocruz. O tamanho do arquivo em CSV √© de cerca de 900MB, j√° em parquet 140MB (15% do CSV).</p>
<div class="meu-raid" style="color:black;background-color:rgb(101, 236, 11);font-size: 100%; padding: 15px; border-radius: 10px;">
<p><strong>Parquet</strong> √© um formato de armazenamento <strong>colunar</strong> , amplamente utilizado em ecossistemas de big data por ser muito eficiente tanto na leitura quanto na escrita, suporta diferentes algoritmos de compress√£o de dados e √© altamente port√°vel √© suportado por ferramentas de Big Data e tamb√©m em Python, R, Julia, DuckDB entre outros.</p>
</div>
<p>Para ler arquivos externos em geral o duckDB j√° vem com a extens√£o httpfs pr√©-instaladas por default</p>
<p>Essa extens√£o √© a respons√°vel por ler e escrever remotamente, ela d√° suporte a leitura por <strong>http</strong> e <strong>https</strong> e leitura e escrita usando <strong>S3</strong> (protocolo da Amazon Clould)</p>
<p>Caso voc√™ tenha algum problema aqui est√° o c√≥digo para instalar, mas n√£o deve ser necess√°rio fazer essa instala√ß√£o.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>INSTALL httpfs;</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>LOAD httpfs;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Antes de come√ßar um projeto maior no duckDB √© recomend√°vel ajustar o tamanho da mem√≥ria e n√∫mero de n√∫cleos da CPU que o duckDB poder√° usar.</p>
<p>Voc√™ deve ajustar esses par√¢metros conforme a quantidade de RAM do seu sistema e a quantidade de n√∫cleos (cores) da sua CPU. Nas CPU modernas um n√∫cleo roda 2 tarefas (Threads) por n√∫cleo. Para a quantidade de memoria um par√¢metro 4GB √© razo√°vel, mas a depender do dado pode ser necess√°rio aumentar esse valor. J√° para a CPU aposta segura √© que toda a maquina √© no m√≠nimo um dual core atualmente.</p>
<p>Mas lembre-se que se voc√™ for usar tamb√©m o R ou alguma outra linguagem / ‚Äòsoftware‚Äô simultaneamente voc√™ deve ajustar esses valores.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> memory_limit <span class="op">=</span> <span class="st">'4GB'</span>; <span class="co">-- ajuste de acordo </span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> threads <span class="kw">TO</span> <span class="dv">4</span>; <span class="co">-- toda cpu moderna tem no minimo 4 threads</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> esus <span class="kw">as</span> (</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span>  <span class="op">*</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> <span class="st">'https://own.procc.fiocruz.br/DS2025/esus_rj.parquet'</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>); </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- cerca de 15 segundos </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>DESCRIBE esus ; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note que a maioria das vari√°veis foi importada como VARCHAR somente index e testeSorologico s√£o inteiros e idade √© um double</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> esus <span class="kw">limit</span> <span class="dv">100</span>; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="limpando-a-tabela-do-esus" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="limpando-a-tabela-do-esus"><span class="header-section-number">3.6.2</span> Limpando a tabela do ESUS</h3>
<p>Vamos proceder algumas transforma√ß√µes para transformar os campos <strong>dataNotificacao, dataInicioSintomas e dataTeste</strong> de texto para data. Repare que eles s√£o, na verdade, do tipo <em>timestamps</em> assim temos de fazer uma dupla transforma√ß√£o, de texto para <em>timestamp</em> e depois de <em>timestamp</em> para <em>date</em>. Vamos aproveitar e colocar um filtro de data de primeiro sintomas maior ou igual a 1 de mar√ßo de 2020 e salvar em uma tabela <strong>esus2</strong>.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">create</span> <span class="kw">or</span> <span class="kw">replace</span> <span class="kw">table</span> esus2 <span class="kw">as</span> ( </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span>  <span class="kw">index</span>, </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cast</span>(dataNotificacao:<span class="ch">:TIMESTAMP</span> <span class="kw">as</span> <span class="dt">date</span>) <span class="kw">as</span> dt_not , <span class="co">--converte pra data</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cast</span>(dataInicioSintomas:<span class="ch">:TIMESTAMP</span> <span class="kw">as</span> <span class="dt">date</span>) <span class="kw">as</span> dt_sint,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cast</span>(dataTeste:<span class="ch">:TIMESTAMP</span> <span class="kw">as</span> <span class="dt">date</span>) <span class="kw">as</span> dt_test,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span> EXCLUDE (dataNotificacao,dataInicioSintomas,dataTeste,index_1) <span class="co">--n√£o h√° virgula!!!</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">from</span> esus <span class="kw">where</span> dt_sint <span class="op">&gt;=</span> <span class="st">'2020-03-01'</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>        ) ;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Podemos visualizar a nova tabela usando o comando <strong>select ‚Ä¶</strong> como j√° fizemos antes no, entretanto existe um atalho para isso. use o painel a direita do duckDB UI para explorar a nova tabela.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> esus2;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="listando" class="level3" data-number="3.6.3">
<h3 data-number="3.6.3" class="anchored" data-anchor-id="listando"><span class="header-section-number">3.6.3</span> Listando</h3>
<p>Como fazer uma listagem dos nomes dos munic√≠pio do estado do Rio de Janeiro que constam da tabela esus2 ?</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="kw">distinct</span> municipio </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> esus2 </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> estado <span class="op">=</span> <span class="st">'RIO DE JANEIRO'</span> </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="kw">order</span> <span class="kw">by</span> municipio;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note que no comando acima temo o uso do <strong><code>DISTINCT</code></strong> √© usado para <strong>eliminar registros duplicados</strong> de um resultado da consulta. O uso de <code>DISTINCT</code> pode impactar a performance, especialmente em tabelas grandes, pois o SQL precisa ordenar e remover duplicados.</p>
<p>caso eu queira saber quantos s√£o:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="fu">count</span>(<span class="kw">distinct</span> municipio) </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> esus2;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="exemplos-de-tabula√ß√µes" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="exemplos-de-tabula√ß√µes"><span class="header-section-number">3.7</span> Exemplos de tabula√ß√µes</h2>
<section id="tabula√ß√µes-simples" class="level3" data-number="3.7.1">
<h3 data-number="3.7.1" class="anchored" data-anchor-id="tabula√ß√µes-simples"><span class="header-section-number">3.7.1</span> Tabula√ß√µes simples</h3>
<p>Tabula√ß√µes simples podem ser obtidas usando alguma fun√ß√£o de agrega√ß√£o como <em>count</em>,<em>sum</em>,<em>avg</em> e combinadas com <code>group by</code> e <code>order by</code></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> racaCor,<span class="fu">count</span>(racaCor) <span class="kw">as</span> freq</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> esus2</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="kw">group</span> <span class="kw">by</span> racaCor </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="kw">order</span> <span class="kw">by</span> freq <span class="kw">desc</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="tabula√ß√µes-avan√ßadas" class="level3" data-number="3.7.2">
<h3 data-number="3.7.2" class="anchored" data-anchor-id="tabula√ß√µes-avan√ßadas"><span class="header-section-number">3.7.2</span> Tabula√ß√µes avan√ßadas</h3>
<p>Tabula√ß√µes avan√ßadas como tabelas cruzadas necessitam de c√≥digos mais complexos usando <code>CASE WHEN</code> , <code>PIVOT</code> , <code>WITH</code> , subquery etc‚Ä¶</p>
<p>Abaixo um exemplo geral de como fazer uma tabela cruzada num SQL qualquer(a vers√£o ISO-92 foi uma das grandes revis√µes, a mais atual √© a ISO-2023).</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    classificacaoFinal,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SUM</span>(<span class="cf">CASE</span> <span class="cf">WHEN</span> sexo <span class="op">=</span> <span class="st">'Masculino'</span> <span class="cf">THEN</span> <span class="dv">1</span> <span class="cf">ELSE</span> <span class="dv">0</span> <span class="cf">END</span>) <span class="kw">AS</span> Masculino,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SUM</span>(<span class="cf">CASE</span> <span class="cf">WHEN</span> sexo <span class="op">=</span> <span class="st">'Feminino'</span> <span class="cf">THEN</span> <span class="dv">1</span> <span class="cf">ELSE</span> <span class="dv">0</span> <span class="cf">END</span>) <span class="kw">AS</span> Feminino,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    Masculino<span class="op">+</span>Feminino <span class="kw">as</span> Total</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> esus2</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="dv">1</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dv">2</span> ;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Usando o dialeto SQL do duckDB (o PostgreSQL √© 98% semelhante ) podemos usar o comando <strong>PIVOT</strong> que reorganiza dados de uma tabela, transformando valores de uma coluna em nomes de colunas e aplicando uma fun√ß√£o de agrega√ß√£o para calcular os valores correspondentes.</p>
<p>No uso a seguir n√£o temos a categoria <code>Total</code> que teria de ser implementada de outra forma. Por outro lado, o comando √© mais enxuto e objetivo.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> (</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> classificacaoFinal, sexo</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> esus2</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>) PIVOT (<span class="fu">COUNT</span>(<span class="op">*</span>) <span class="cf">FOR</span> sexo <span class="kw">IN</span> (<span class="st">'Masculino'</span>, <span class="st">'Feminino'</span>))</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dv">2</span> ;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>E se quis√©ssemos adicionar uma linha final totalizando todas as classifica√ß√µes?</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Total'</span> <span class="kw">AS</span> classificacaoFinal,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SUM</span>(<span class="cf">CASE</span> <span class="cf">WHEN</span> sexo <span class="op">=</span> <span class="st">'Masculino'</span> <span class="cf">THEN</span> <span class="dv">1</span> <span class="cf">ELSE</span> <span class="dv">0</span> <span class="cf">END</span>) <span class="kw">AS</span> Masculino,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SUM</span>(<span class="cf">CASE</span> <span class="cf">WHEN</span> sexo <span class="op">=</span> <span class="st">'Feminino'</span> <span class="cf">THEN</span> <span class="dv">1</span> <span class="cf">ELSE</span> <span class="dv">0</span> <span class="cf">END</span>) <span class="kw">AS</span> Feminino,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    Masculino <span class="op">+</span> Feminino <span class="kw">AS</span> Total</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> esus2</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span>   Total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>E como colocar tudo isso junto numa mesma query?</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    classificacaoFinal,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SUM</span>(<span class="cf">CASE</span> <span class="cf">WHEN</span> sexo <span class="op">=</span> <span class="st">'Masculino'</span> <span class="cf">THEN</span> <span class="dv">1</span> <span class="cf">ELSE</span> <span class="dv">0</span> <span class="cf">END</span>) <span class="kw">AS</span> Masculino,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SUM</span>(<span class="cf">CASE</span> <span class="cf">WHEN</span> sexo <span class="op">=</span> <span class="st">'Feminino'</span> <span class="cf">THEN</span> <span class="dv">1</span> <span class="cf">ELSE</span> <span class="dv">0</span> <span class="cf">END</span>) <span class="kw">AS</span> Feminino,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>     Masculino <span class="op">+</span> Feminino <span class="kw">AS</span> Total</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> esus2</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="dv">1</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Total'</span> <span class="kw">AS</span> classificacaoFinal,</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SUM</span>(<span class="cf">CASE</span> <span class="cf">WHEN</span> sexo <span class="op">=</span> <span class="st">'Masculino'</span> <span class="cf">THEN</span> <span class="dv">1</span> <span class="cf">ELSE</span> <span class="dv">0</span> <span class="cf">END</span>) <span class="kw">AS</span> Masculino,</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SUM</span>(<span class="cf">CASE</span> <span class="cf">WHEN</span> sexo <span class="op">=</span> <span class="st">'Feminino'</span> <span class="cf">THEN</span> <span class="dv">1</span> <span class="cf">ELSE</span> <span class="dv">0</span> <span class="cf">END</span>) <span class="kw">AS</span> Feminino,</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    Masculino <span class="op">+</span> Feminino <span class="kw">AS</span> Total</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> esus2</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span>   Total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Se voc√™ fez tudo corretamente deve chegar a uma tabela como essa:</p>
<p><img src="figuras/result_crosstab.png" class="img-fluid"></p>
<section id="common-table-expression-cte" class="level4" data-number="3.7.2.1">
<h4 data-number="3.7.2.1" class="anchored" data-anchor-id="common-table-expression-cte"><span class="header-section-number">3.7.2.1</span> <strong>Common Table Expression (CTE)</strong></h4>
<p>Uma CTE √© uma subconsulta que pode ser nomeada e usada dentro de uma consulta SQL subsequente. Ela √© definida com a cl√°usula <code>WITH</code> e serve para organizar e simplificar consultas complexas, tornando o c√≥digo mais leg√≠vel e f√°cil de manter.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> filtro_obito <span class="kw">as</span> (</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">select</span> <span class="op">*</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>   <span class="kw">from</span> esus2</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>   <span class="kw">where</span> evolucaoCaso <span class="op">=</span> <span class="st">'√ìbito'</span> <span class="kw">and</span> regexp_matches(classificacaoFinal,<span class="st">'^Confirmado'</span>,<span class="st">'i'</span>) </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> sexo, </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="op">*</span>) <span class="kw">as</span> freq , </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ROUND</span>((freq <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> (<span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">FROM</span> filtro_obito )), <span class="dv">2</span>) <span class="kw">AS</span> percentual </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> filtro_obito </span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="kw">group</span> <span class="kw">by</span> <span class="dv">1</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note o uso de uma das fun√ß√µes de express√£o regular (<em>regexp_matches</em>) para selecionar todos que come√ßam pela palavra ‚ÄúConfirmado‚Äù . Existem muitas fun√ß√µes que lidam com textos e o uso delas em especial das express√µes regulares nos possibilita uma enorme gama de solu√ß√µes r√°pidas e simples.</p>
<p>Vamos ver mais sobre esse assunto na pr√≥xima aula.</p>
</section>
</section>
</section>
<section id="conclus√£o" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="conclus√£o"><span class="header-section-number">3.8</span> Conclus√£o</h2>
<div class="meu-raid" style="color:black;background-color:rgb(101, 236, 11);font-size: 100%; padding: 15px; border-radius: 10px;">
<p><strong>Conclus√µes da aula de SQL</strong></p>
<p>Esses s√£o apenas os primeiros passos no SQL h√° muito mais a ser aprendido como voc√™s viram ele √© flex√≠vel e relativamente simples ainda que tenhamos de escrever um c√≥digo um tanto mais longo se comparado ao <strong>R</strong>.</p>
<ul>
<li><p>SQL √© <strong>linguagem nativa para manipula√ß√£o e consulta de dados em bancos relacionais</strong>, enquanto R e Python s√£o linguagens gerais</p></li>
<li><p>SQL √© <strong>otimizado para consultas em grandes volumes de dados</strong> armazenados em bancos, com suporte a <strong>√≠ndices, otimiza√ß√£o de consultas e ACID</strong> (atomicidade, consist√™ncia, isolamento, dura√ß√£o).</p></li>
<li><p>SQL √© padr√£o para interagir com bancos de dados, facilitando a manipula√ß√£o de dados diretamente no armazenamento, sem precisar carregar todos os dados em mem√≥ria (como em R/Python)</p></li>
<li><p>SQL √© mais eficiente para <strong>consultas distribu√≠das</strong> (ex: clusters, bancos em nuvem)</p></li>
</ul>
<p><strong>Onde aprender mais sobre SQL</strong>:</p>
<p>Existem muitos tutoriais em plataformas de cursos (a maioria n√£o √© gratuita) , livros, cap√≠tulos de livros , apostilas e v√≠deos no youtube.</p>
<p>Abaixo alguns recursos gratuitos:</p>
<ul>
<li><a href="https://www.w3schools.com/sql/">Tutorial online W3 - com exerc√≠cios interativos</a></li>
<li><a href="https://www.tutorialspoint.com/sql/sql_tutorial.pdf">SQL Tutorial in PDF</a></li>
<li><a href="https://duckdb.org/docs/stable/">Documenta√ß√£o online do duckDB</a></li>
</ul>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./intro.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introdu√ß√£o √† Ci√™ncia de Dados em Epidemiologia</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link">
        <span class="nav-page-text">Referencias</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>